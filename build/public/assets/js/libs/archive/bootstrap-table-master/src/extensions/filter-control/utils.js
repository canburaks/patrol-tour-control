const Utils=$.fn.bootstrapTable.utils,searchControls='select, input:not([type="checkbox"]):not([type="radio"])';export function getOptionsFromSelectControl(t){return t.get(t.length-1).options}export function getControlContainer(t){return t.options.filterControlContainer?$(`${t.options.filterControlContainer}`):t.$header}export function getSearchControls(t){return getControlContainer(t).find(searchControls)}export function hideUnusedSelectOptions(t,e){const o=getOptionsFromSelectControl(t);for(let n=0;n<o.length;n++)""!==o[n].value&&(e.hasOwnProperty(o[n].value)?t.find(Utils.sprintf("option[value='%s']",o[n].value)).show():t.find(Utils.sprintf("option[value='%s']",o[n].value)).hide())}export function existOptionInSelectControl(t,e){const o=getOptionsFromSelectControl(t);for(let t=0;t<o.length;t++)if(o[t].value===Utils.unescapeHTML(e.toString()))return!0;return!1}export function addOptionToSelectControl(t,e,o,n){const r=null==e?"":e.toString().trim(),l=$(t.get(t.length-1));if(!existOptionInSelectControl(t,r)){const t=$(`<option value="${r}">${o}</option>`);r===n&&t.attr("selected",!0),l.append(t)}}export function sortSelectControl(t,e){const o=$(t.get(t.length-1)),n=o.find("option:gt(0)");"server"!==e&&n.sort(((t,o)=>Utils.sort(t.textContent,o.textContent,"desc"===e?-1:1))),o.find("option:gt(0)").remove(),o.append(n)}export function fixHeaderCSS({$tableHeader:t}){t.css("height","89px")}export function getElementClass(t){return t.attr("class").replace("form-control","").replace("focus-temp","").replace("search-input","").trim()}export function getCursorPosition(t){if(Utils.isIEBrowser()){if($(t).is("input[type=text]")){let e=0;if("selectionStart"in t)e=t.selectionStart;else if("selection"in document){t.focus();const o=document.selection.createRange(),n=document.selection.createRange().text.length;o.moveStart("character",-t.value.length),e=o.text.length-n}return e}return-1}return-1}export function setCursorPosition(t){$(t).val(t.value)}export function copyValues(t){const e=getSearchControls(t);t.options.valuesFilterControl=[],e.each((function(){let e=$(this);if(t.options.height){const t=getElementClass(e);e=$(`.fixed-table-header .${t}`)}t.options.valuesFilterControl.push({field:e.closest("[data-field]").data("field"),value:e.val(),position:getCursorPosition(e.get(0)),hasFocus:e.is(":focus")})}))}export function setValues(t){let e=null,o=[];const n=getSearchControls(t);if(t.options.valuesFilterControl.length>0){let r=null;n.each(((n,l)=>{const i=$(l);if(e=i.closest("[data-field]").data("field"),o=t.options.valuesFilterControl.filter((t=>t.field===e)),o.length>0){if(i.is("[type=radio]"))return;i.val(o[0].value),o[0].hasFocus&&""!==o[0].value&&(s=i.get(0),a=o[0].position,r=()=>{s.focus(),setCursorPosition(s,a)})}var s,a})),null!==r&&r()}}export function collectBootstrapCookies(){const t=[],e=document.cookie.match(/(?:bs.table.)(\w*)/g),o=localStorage;if(e&&$.each(e,((e,o)=>{let n=o;/./.test(n)&&(n=n.split(".").pop()),-1===$.inArray(n,t)&&t.push(n)})),o)for(let e=0;e<o.length;e++){let n=o.key(e);/./.test(n)&&(n=n.split(".").pop()),t.includes(n)||t.push(n)}return t}export function escapeID(t){return String(t).replace(/([:.\[\],])/g,"\\$1")}export function isColumnSearchableViaSelect({filterControl:t,searchable:e}){return t&&"select"===t.toLowerCase()&&e}export function isFilterDataNotGiven({filterData:t}){return void 0===t||"column"===t.toLowerCase()}export function hasSelectControlElement(t){return t&&t.length>0}export function initFilterSelectControls(t){const e=t.data,o=t.options.pagination?"server"===t.options.sidePagination?t.pageTo:t.options.totalRows:t.pageTo;$.each(t.header.fields,((n,r)=>{const l=t.columns[t.fieldsColumnsIndex[r]],i=getControlContainer(t).find(`select.bootstrap-table-filter-control-${escapeID(l.field)}`);if(isColumnSearchableViaSelect(l)&&isFilterDataNotGiven(l)&&hasSelectControlElement(i)){0===i.get(i.length-1).options.length&&addOptionToSelectControl(i,"",l.filterControlPlaceholder||"&nbsp;",l.filterDefault);const s={};for(let a=0;a<o;a++){let o=Utils.getItemField(e[a],r,!1);const c=t.options.editable&&l.editable?l._formatter:t.header.formatters[n];let f=Utils.calculateObjectValue(t.header,c,[o,e[a],a],o);if(l.filterDataCollector&&(f=Utils.calculateObjectValue(t.header,l.filterDataCollector,[o,e[a],f],f)),l.searchFormatter&&(o=f),s[f]=o,"object"!=typeof f||null===f)for(const t in s)addOptionToSelectControl(i,s[t],t,l.filterDefault);else f.forEach((t=>{addOptionToSelectControl(i,t,t,l.filterDefault)}))}sortSelectControl(i,l.filterOrderBy),t.options.hideUnusedSelectOptions&&hideUnusedSelectOptions(i,s)}}))}export function getFilterDataMethod(t,e){const o=Object.keys(t);for(let n=0;n<o.length;n++)if(o[n]===e)return t[e];return null}export function createControls(t,e){let o,n=!1;$.each(t.columns,((r,l)=>{if(o=[],l.visible){if(l.filterControl||t.options.filterControlContainer)if(t.options.filterControlContainer){const t=$(`.bootstrap-table-filter-control-${l.field}`);$.each(t,((t,e)=>{const o=$(e);if(!o.is("[type=radio]")){const t=l.filterControlPlaceholder?l.filterControlPlaceholder:"";o.attr("placeholder",t).val(l.filterDefault)}o.attr("data-field",l.field)})),n=!0}else{const e=l.filterControl.toLowerCase();o.push('<div class="filter-control">'),n=!0,l.searchable&&t.options.filterTemplate[e]&&o.push(t.options.filterTemplate[e](t,l.field,l.filterControlPlaceholder?l.filterControlPlaceholder:"",l.filterDefault))}else o.push('<div class="no-filter-control"></div>');if(l.filterControl||""===l.filterDefault||void 0===l.filterDefault||($.isEmptyObject(t.filterColumnsPartial)&&(t.filterColumnsPartial={}),t.filterColumnsPartial[l.field]=l.filterDefault),$.each(e.find("th"),((t,e)=>{const n=$(e);if(n.data("field")===l.field)return n.find(".fht-cell").append(o.join("")),!1})),l.filterData&&"column"!==l.filterData.toLowerCase()){const o=getFilterDataMethod(filterDataMethods,l.filterData.substring(0,l.filterData.indexOf(":")));let n,r;if(!o)throw new SyntaxError('Error. You should use any of these allowed filter data methods: var, obj, json, url, func. Use like this: var: {key: "value"}');n=l.filterData.substring(l.filterData.indexOf(":")+1,l.filterData.length),r=e.find(`.bootstrap-table-filter-control-${escapeID(l.field)}`),addOptionToSelectControl(r,"",l.filterControlPlaceholder,l.filterDefault),o(n,r,t.options.filterOrderBy,l.filterDefault)}}})),n?(e.off("keyup","input").on("keyup","input",(({currentTarget:e,keyCode:o},n)=>{if(syncControls(t),o=n?n.keyCode:o,t.options.searchOnEnterKey&&13!==o)return;if($.inArray(o,[37,38,39,40])>-1)return;const r=$(e);r.is(":checkbox")||r.is(":radio")||(clearTimeout(e.timeoutId||0),e.timeoutId=setTimeout((()=>{t.onColumnSearch({currentTarget:e,keyCode:o})}),t.options.searchTimeOut))})),e.off("change",'select:not(".ms-offscreen")').on("change",'select:not(".ms-offscreen")',(({currentTarget:e,keyCode:o})=>{syncControls(t);const n=$(e),r=n.val();r&&r.length>0&&r.trim()?(n.find("option[selected]").removeAttr("selected"),n.find(`option[value="${r}"]`).attr("selected",!0)):n.find("option[selected]").removeAttr("selected"),clearTimeout(e.timeoutId||0),e.timeoutId=setTimeout((()=>{t.onColumnSearch({currentTarget:e,keyCode:o})}),t.options.searchTimeOut)})),e.off("mouseup","input:not([type=radio])").on("mouseup","input:not([type=radio])",(({currentTarget:e,keyCode:o})=>{const n=$(e);""!==n.val()&&setTimeout((()=>{syncControls(t);""===n.val()&&(clearTimeout(e.timeoutId||0),e.timeoutId=setTimeout((()=>{t.onColumnSearch({currentTarget:e,keyCode:o})}),t.options.searchTimeOut))}),1)})),e.off("change","input[type=radio]").on("change","input[type=radio]",(({currentTarget:e,keyCode:o})=>{clearTimeout(e.timeoutId||0),e.timeoutId=setTimeout((()=>{syncControls(t),t.onColumnSearch({currentTarget:e,keyCode:o})}),t.options.searchTimeOut)})),e.find(".date-filter-control").length>0&&$.each(t.columns,((o,{filterDefault:n,filterControl:r,field:l,filterDatepickerOptions:i})=>{if(void 0!==r&&"datepicker"===r.toLowerCase()){const o=e.find(`.date-filter-control.bootstrap-table-filter-control-${l}`);o.datepicker(i),n&&o.datepicker("setDate",n),o.on("changeDate",(({currentTarget:e,keyCode:o})=>{clearTimeout(e.timeoutId||0),e.timeoutId=setTimeout((()=>{syncControls(t),t.onColumnSearch({currentTarget:e,keyCode:o})}),t.options.searchTimeOut)}))}})),"server"===t.options.sidePagination||t.options.height||t.triggerSearch(),t.options.filterControlVisible||e.find(".filter-control, .no-filter-control").hide()):e.find(".filter-control, .no-filter-control").hide(),t.trigger("created-controls")}export function getDirectionOfSelectOptions(t){switch(void 0===t?"left":t.toLowerCase()){case"left":return"ltr";case"right":return"rtl";case"auto":return"auto";default:return"ltr"}}export function syncControls(t){if(t.options.height){const e=t.$tableHeader.find(searchControls);t.$header.find(searchControls).each(((t,o)=>{const n=$(o),r=getElementClass(n),l=e.filter(((t,e)=>{const o=getElementClass($(e));return r===o}));0!==l.length&&(n.is("select")?(n.find("option:selected").removeAttr("selected"),n.find(`option[value='${l.val()}']`).attr("selected",!0)):n.val(l.val()))}))}}const filterDataMethods={func(t,e,o,n){const r=window[t].apply();for(const t in r)addOptionToSelectControl(e,t,r[t],n);sortSelectControl(e,o)},obj(t,e,o,n){const r=t.split("."),l=r.shift();let i=window[l];r.length>0&&r.forEach((t=>{i=i[t]}));for(const t in i)addOptionToSelectControl(e,t,i[t],n);sortSelectControl(e,o)},var(t,e,o,n){const r=window[t],l=Array.isArray(r);for(const t in r)addOptionToSelectControl(e,l?r[t]:t,r[t],n);sortSelectControl(e,o)},url(t,e,o,n){$.ajax({url:t,dataType:"json",success(t){for(const o in t)addOptionToSelectControl(e,o,t[o],n);sortSelectControl(e,o)}})},json(t,e,o,n){const r=JSON.parse(t);for(const t in r)addOptionToSelectControl(e,t,r[t],n);sortSelectControl(e,o)}};